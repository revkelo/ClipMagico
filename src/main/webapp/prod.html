<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Consulta de Precio de Producto</title>
<style>
    .container {
        max-width: 800px;
        margin: 50px auto;
        text-align: center;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
    }

    th, td {
        padding: 10px;
        border: 1px solid #ddd;
    }

    th {
        background-color: #f2f2f2;
    }

    button {
        padding: 10px 20px;
        background-color: #007bff;
        color: #fff;
        border: none;
        cursor: pointer;
    }
</style>
</head>
<body>

<div class="container">
    <h1>Consulta de Precio de Producto</h1>
    <input type="text" id="productId" placeholder="ID del Producto">
    <input type="number" id="quantity" placeholder="Cantidad">
    <button id="getPriceBtn">Obtener Precio</button>
    <table id="productTable">
        <tr>
            <th>ID Producto</th>
            <th>Nombre</th>
            <th>Descripci√≥n</th>
            <th>ID Proveedor</th>
            <th>Precio</th>
            <th>Cantidad</th>
            <th>Total</th>
        </tr>
    </table>
    <h1 id="totalSum">Suma Total: $0</h1>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        $('#getPriceBtn').click(function() {
            var productId = $('#productId').val();
            var quantity = $('#quantity').val();

            // Send GET request to servlet
            $.get('http://localhost:8080/ClipMagico/prod?id=' + productId, function(data) {
                // Show the price in an alert
                alert('El precio del producto es: ' + data.precio);

                // Log the object to console
                console.log(data);

                // Calculate total
                var total = data.precio * quantity;

                // Add row to the table with search result
                addRowToTable(data, quantity, total);

                // Update total sum
                updateTotalSum();
            });
        });

        function addRowToTable(producto, quantity, total) {
            var newRow = '<tr>';
            newRow += '<td>' + producto.idProducto + '</td>';
            newRow += '<td>' + producto.nombre + '</td>';
            newRow += '<td>' + producto.descripcion + '</td>';
            newRow += '<td>' + producto.idProveedor + '</td>';
            newRow += '<td>' + producto.precio + '</td>';
            newRow += '<td>' + quantity + '</td>';
            newRow += '<td>' + total + '</td>';
            newRow += '</tr>';

            $('#productTable').append(newRow);
        }

        function updateTotalSum() {
            var totalSum = 0;
            $('#productTable tbody tr').each(function() {
                var totalCell = $(this).find('td:last').text();
                totalSum += parseFloat(totalCell) || 0; // Asegurar que NaN se convierta en 0
            });
            $('#totalSum').text('Suma Total: $' + totalSum.toFixed(2));
        }
    });
</script>
</body>
</html>
